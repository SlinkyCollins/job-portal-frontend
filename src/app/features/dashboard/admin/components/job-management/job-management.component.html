<div class="admin-page-header fade-in">
    <h2>Job Management</h2>
    <p>Monitor and manage active job listings</p>
</div>

<div class="admin-table-container fade-in">

    <div *ngIf="isLoading" class="loading-spinner">
        <div class="spinner-border text-success" role="status"></div>
        <p class="mt-2 text-muted">Loading jobs...</p>
    </div>

    <ng-container *ngIf="!isLoading">
        <table class="admin-table">
            <thead>
                <tr>
                    <th class="th-title">Job Title</th>
                    <th class="th-company">Company</th>
                    <th class="th-type">Type</th>
                    <th class="th-status">Status</th>
                    <th class="th-posted">Posted By</th>
                    <th class="th-stats">Applicants</th>
                    <th class="th-date">Date</th>
                    <th class="th-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let job of paginatedJobs">

                    <td class="col-title" data-label="Job Title">
                        <div class="job-title-text">{{ job.job_title }}</div>
                        <div class="job-location"><i class="fas fa-map-marker-alt me-1"></i> {{ job.location }}</div>
                    </td>

                    <td class="col-company" data-label="Company">
                        <span class="company-name">{{ job.company_name || 'Confidential' }}</span>
                    </td>

                    <td class="col-type" data-label="Type">
                        <span class="badge-type">{{ job.job_type }}</span>
                    </td>

                    <td class="col-status" data-label="Status">
                        <span class="badge-status" [class.badge-pending]="job.status === 'pending'"
                            [class.badge-active]="job.status === 'active'"
                            [class.badge-closed]="job.status === 'closed'">
                            {{ job.status | titlecase }}
                        </span>
                    </td>

                    <td class="col-posted" data-label="Posted By">
                        <div class="poster-info">
                            <div class="poster-avatar">
                                {{ job.firstname | initials:job.lastname }}
                            </div>
                            <span class="poster-name">{{ job.firstname }} {{ job.lastname }}</span>
                        </div>
                    </td>

                    <td class="col-stats" data-label="Applicants">
                        <span class="badge-stats">
                            <i class="fas fa-users me-1"></i> {{ job.application_count }}
                        </span>
                    </td>

                    <td class="col-date" data-label="Date">
                        {{ job.created_at | date:'mediumDate' }}
                    </td>

                    <td class="col-actions" data-label="Actions">
                        <button class="action-btn approve" [disabled]="job.status !== 'pending'"
                            [title]="job.status === 'pending' ? 'Approve Job' : 'Job is not pending'"
                            (click)="updateJobStatus(job.job_id, 'active')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="action-btn close" [disabled]="job.status === 'closed'"
                            [title]="job.status === 'closed' ? 'Job is already closed' : 'Close Job'"
                            (click)="updateJobStatus(job.job_id, 'closed')">
                            <i class="fas fa-times"></i>
                        </button>
                        <button class="action-btn delete" (click)="deleteJob(job.job_id)" title="Delete Job">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>

                <tr *ngIf="jobs.length === 0">
                    <td colspan="8" class="text-center py-5">
                        <div class="empty-state">
                            <i class="fas fa-briefcase fa-2x mb-3 text-muted"></i>
                            <p>No jobs found.</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination-footer" *ngIf="jobs.length > pageSize">
            <div class="pagination-info">
                Showing <strong>{{ (currentPage - 1) * pageSize + 1 }}</strong> to
                <strong>{{ (currentPage * pageSize) > jobs.length ? jobs.length : (currentPage * pageSize) }}</strong>
                of <strong>{{ jobs.length }}</strong> jobs
            </div>

            <div class="pagination-controls">
                <button class="page-btn prev" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <ng-container *ngFor="let page of totalPagesArray">
                    <button
                        *ngIf="totalPages <= 7 || page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)"
                        class="page-btn number" [class.active]="currentPage === page" (click)="changePage(page)">
                        {{ page }}
                    </button>
                    <span
                        *ngIf="totalPages > 7 && ((page === 2 && currentPage > 4) || (page === totalPages - 1 && currentPage < totalPages - 3))"
                        class="dots">...</span>
                </ng-container>

                <button class="page-btn next" [disabled]="currentPage === totalPages"
                    (click)="changePage(currentPage + 1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </ng-container>
</div>

<div class="modal-overlay" [class.active]="showDeleteConfirm" (click)="hideDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Delete Job</h3>
            <button class="modal-close" (click)="hideDeleteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="warning-icon">
                <i class="fas fa-trash-alt"></i>
            </div>
            <p>Are you sure you want to delete this job posting? <br><strong>This action cannot be undone.</strong></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-cancel" (click)="hideDeleteModal()">Cancel</button>
            <button class="btn btn-confirm" (click)="confirmDelete()">Delete Job</button>
        </div>
    </div>
</div>