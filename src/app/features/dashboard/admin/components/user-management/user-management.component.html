<div class="admin-page-header fade-in">
  <h2>User Management</h2>
  <p>Manage all registered users</p>
</div>

<div class="admin-table-container fade-in">

  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner-border text-success" role="status"></div>
    <p class="mt-2 text-muted">Loading users...</p>
  </div>

  <ng-container *ngIf="!isLoading">
    <table class="admin-table">
      <thead>
        <tr>
          <th class="th-id">ID</th>
          <th class="th-user">User</th>
          <th class="th-role">Role</th>
          <th class="th-email">Email</th>
          <th class="th-date">Joined Date</th>
          <th class="th-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUsers">

          <td class="col-id" data-label="ID">
            <span class="id-badge">#{{ user.user_id }}</span>
          </td>

          <td class="col-user">
            <div class="user-cell">
              <div class="user-avatar-wrapper">
                <div class="user-initials">
                  {{ user.firstname | initials:user.lastname }}
                </div>
              </div>
              <div class="user-info">
                <span class="user-name">{{ user.firstname }} {{ user.lastname }}</span>
                <span class="user-email-mobile d-md-none">{{ user.email }}</span>
              </div>
            </div>
          </td>

          <td class="col-role" data-label="Role">
            <span class="role-badge" [ngClass]="{
                'admin': user.role === 'admin',
                'employer': user.role === 'employer',
                'job_seeker': user.role === 'job_seeker'
              }">
              {{ user.role === 'job_seeker' ? 'Job Seeker' : (user.role | titlecase) }}
            </span>
          </td>

          <td class="col-email" data-label="Email">
            {{ user.email }}
          </td>

          <td class="col-date" data-label="Joined">
            {{ user.createdat | date:'mediumDate' }}
          </td>

          <td class="col-actions" data-label="Actions">
            <button *ngIf="user.role !== 'admin'" class="action-btn suspend" (click)="toggleSuspend(user)"
              title="{{ user.suspended ? 'Unsuspend' : 'Suspend' }} User">
              <i class="fas fa-{{ user.suspended ? 'play' : 'pause' }}"></i>
            </button>
            <button *ngIf="user.role !== 'admin'" class="action-btn delete" (click)="deleteUser(user.user_id)" title="Delete User">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>

        </tr>

        <tr *ngIf="users.length === 0">
          <td colspan="6" class="text-center py-5">
            <div class="empty-state">
              <i class="fas fa-users-slash fa-2x mb-3 text-muted"></i>
              <p>No users found.</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="pagination-footer" *ngIf="users.length > pageSize">
      <div class="pagination-info">
        Showing <strong>{{ (currentPage - 1) * pageSize + 1 }}</strong> to
        <strong>{{ (currentPage * pageSize) > users.length ? users.length : (currentPage * pageSize) }}</strong>
        of <strong>{{ users.length }}</strong> users
      </div>

      <div class="pagination-controls">
        <button class="page-btn prev" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
          <i class="fas fa-chevron-left"></i>
        </button>

        <ng-container *ngFor="let page of totalPagesArray">
          <button
            *ngIf="totalPages <= 7 || page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)"
            class="page-btn number" [class.active]="currentPage === page" (click)="changePage(page)">
            {{ page }}
          </button>
          <span
            *ngIf="totalPages > 7 && ((page === 2 && currentPage > 4) || (page === totalPages - 1 && currentPage < totalPages - 3))"
            class="dots">...</span>
        </ng-container>

        <button class="page-btn next" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </ng-container>
</div>

<div class="modal-overlay" [class.active]="showDeleteConfirm" (click)="hideDeleteModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Confirm Deletion</h3>
      <button class="modal-close" (click)="hideDeleteModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="logout-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <p>Are you sure you want to delete this user? <br><strong>This action cannot be undone.</strong></p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="hideDeleteModal()">Cancel</button>
      <button class="btn btn-confirm" (click)="confirmDelete()">Delete User</button>
    </div>
  </div>
</div>