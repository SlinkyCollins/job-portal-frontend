<div class="container-fluid px-3 px-md-5 py-4">
  <div class="row align-items-center mb-4">
    <div class="col-12 col-md-6">
      <h2 class="saved-jobs-title mb-3 mb-md-0">{{ pageTitle }}</h2>
    </div>
    <div class="col-12 col-md-6" *ngIf="!isLoading && savedJobs.length > 0">
      <div class="d-flex justify-content-md-end">
        <div class="sort-container">
          <label class="sort-label me-2">{{ sortLabel }}:</label>
          <select class="form-select sort-select" [(ngModel)]="selectedSort" (change)="onSortChange()">
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="jobs-container">
    <div *ngIf="isLoading" class="skeleton-container">
      <div class="skeleton-card mb-3" *ngFor="let i of [1,2,3]">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-lg-none mobile-job-layout">
              <div class="d-flex align-items-start mb-3">
                <div class="skeleton-logo me-3"></div>
                <div class="flex-grow-1">
                  <div class="skeleton-title mb-2"></div>
                </div>
                <div class="skeleton-btn"></div>
              </div>
              <div class="skeleton-type mb-2"></div>
              <div class="skeleton-salary mb-2"></div>
              <div class="skeleton-location mb-2"></div>
              <div class="skeleton-tags"></div>
            </div>
            <div class="d-none d-lg-block desktop-job-layout">
              <div class="row align-items-center">
                <div class="col-auto">
                  <div class="skeleton-logo"></div>
                </div>
                <div class="col-lg-4">
                  <div class="skeleton-title"></div>
                </div>
                <div class="col-lg-3">
                  <div class="skeleton-type"></div>
                  <div class="skeleton-salary mt-1"></div>
                </div>
                <div class="col-lg-3">
                  <div class="skeleton-location mb-1"></div>
                  <div class="skeleton-tags"></div>
                </div>
                <div class="col-auto ms-auto">
                  <div class="skeleton-btn"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading">
      <div class="job-card mb-3" *ngFor="let job of savedJobs; let i = index">
        <div class="card h-100">
          <div class="card-body">

            <div class="d-lg-none mobile-job-layout">
              <div class="d-flex align-items-start mb-3">
                <div class="company-logo me-3">
                  <img [src]="job.companyLogo" [alt]="job.companyName + ' logo'" class="logo-img">
                </div>

                <div class="flex-grow-1">
                  <h5 class="job-title mb-0">{{ job.title }}</h5>
                </div>

                <div class="dropdown mobile-dropdown ms-2">
                  <button class="btn action-btn" data-bs-toggle="dropdown" aria-expanded="false"
                    [attr.aria-label]="'Actions for ' + job.title">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" (click)="onJobAction('view', job)">
                        <i class="fas fa-eye me-2"></i>View Job
                      </a></li>
                    <li><a class="dropdown-item" (click)="onJobAction('share', job)">
                        <i class="fas fa-share me-2"></i>Share
                      </a></li>
                    <li><a class="dropdown-item" (click)="onJobAction('apply', job)">
                        <i class="fas fa-paper-plane me-2"></i>Apply Now
                      </a></li>
                    <li>
                      <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item text-danger" (click)="onJobAction('remove', job)">
                        <i class="fas fa-trash me-2"></i>Remove
                      </a></li>
                  </ul>
                </div>
              </div>

              <div class="job-type-container mb-2">
                <span class="job-type" [ngClass]="getJobTypeClass(job.type)">
                  {{ job.type }}
                </span>
              </div>

              <div class="salary-info mb-2">
                <span class="salary">{{ job.salary | currency: job.currency :'symbol-narrow':'1.0-0' }}</span>
                <span class="salary-period text-muted-stronger"> / {{ job.salaryPeriod }} · {{ job.experienceLevel
                  }}</span>
              </div>

              <div class="location mb-2">
                <span class="text-muted-stronger">{{ job.location }}</span>
              </div>

              <div class="job-tags">
                <span *ngFor="let tag of job.tags; let last = last" class="tag">
                  {{ tag }}<span *ngIf="!last">,</span>
                </span>
              </div>
            </div>
            <div class="d-none d-lg-block desktop-job-layout">
              <div class="row align-items-center">

                <div class="col-auto">
                  <div class="company-logo">
                    <img [src]="job.companyLogo" [alt]="job.companyName + ' logo'" class="logo-img">
                  </div>
                </div>

                <div class="col-lg-4">
                  <h5 class="job-title mb-0">{{ job.title }}</h5>
                </div>

                <div class="col-lg-3">
                  <span class="job-type" [ngClass]="getJobTypeClass(job.type)">
                    {{ job.type }}
                  </span>
                  <div class="salary-info mt-1">
                    <span class="salary">{{ job.salary | currency: job.currency :'symbol-narrow':'1.0-0' }}</span>
                    <span class="salary-period text-muted-stronger"> / {{ job.salaryPeriod }} · {{ job.experienceLevel
                      }}</span>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div class="location mb-1">
                    <i class="fas fa-map-marker-alt text-muted-stronger me-1"></i>
                    <span class="text-muted-stronger">{{ job.location }}</span>
                  </div>
                  <div class="job-tags">
                    <span *ngFor="let tag of job.tags; let last = last" class="tag">
                      {{ tag }}<span *ngIf="!last">, </span>
                    </span>
                  </div>
                </div>

                <div class="col-auto ms-auto">
                  <div class="dropdown desktop-dropdown">
                    <button class="btn action-btn" data-bs-toggle="dropdown" aria-expanded="false"
                      [attr.aria-label]="'Actions for ' + job.title">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li><a class="dropdown-item" (click)="onJobAction('view', job)">
                          <i class="fas fa-eye me-2"></i>View Job
                        </a></li>
                      <li><a class="dropdown-item" (click)="onJobAction('share', job)">
                          <i class="fas fa-share me-2"></i>Share
                        </a></li>
                      <li><a class="dropdown-item" (click)="onJobAction('apply', job)">
                          <i class="fas fa-paper-plane me-2"></i>Apply Now
                        </a></li>
                      <li>
                        <hr class="dropdown-divider">
                      </li>
                      <li><a class="dropdown-item text-danger" (click)="onJobAction('remove', job)">
                          <i class="fas fa-trash me-2"></i>Remove
                        </a></li>
                    </ul>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && savedJobs.length === 0" class="empty-state text-center py-5">
    <div class="empty-state-content">
      <img src="/assets/EmptyImg.svg" alt="No saved jobs illustration" class="empty-state-image mb-3" />
      <h4 class="empty-state-title text-muted">No Saved Jobs Yet</h4>
      <p class="empty-state-subtitle text-secondary">Start saving jobs to keep track of opportunities you're interested
        in.</p>
    </div>
  </div>

  <nav aria-label="Saved jobs pagination" class="mt-4" *ngIf="totalJobs > perPage">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="goToPage(currentPage - 1)" aria-label="Previous">
          <i class="fas fa-chevron-left"></i>
        </a>
      </li>

      <li *ngFor="let page of visiblePages" class="page-item" [class.active]="page === currentPage">
        <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
      </li>

      <li *ngIf="showEllipsis" class="page-item disabled">
        <span class="page-link">...</span>
      </li>

      <li *ngIf="totalPages > 5" class="page-item">
        <a class="page-link" (click)="goToPage(totalPages)">{{ totalPages }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="goToPage(currentPage + 1)" aria-label="Next">
          <i class="fas fa-chevron-right"></i>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Remove Confirmation Modal -->
  <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="removeModalLabel">Remove Saved Job</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to remove this job from your saved jobs?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmRemoveBtn" (click)="confirmRemove()">Remove</button>
        </div>
      </div>
    </div>
  </div>
</div>