<div class="applied-jobs-container">
  <div class="page-header">
    <h1 class="page-title">My Applications</h1>
    <p class="text-muted">Track and manage all your job applications</p>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="job-item skeleton" *ngFor="let i of [1,2,3,4,5]">
      <div class="job-icon skeleton-icon"></div>
      <div class="job-info">
        <div class="skeleton-text skeleton-title"></div>
        <div class="skeleton-text skeleton-subtitle"></div>
      </div>
    </div>
  </div>

  <!-- Applications List -->
  <div class="applications-list" *ngIf="!isLoading && applications.length > 0">
    <div class="job-item" *ngFor="let application of paginatedApplications">
      <div class="job-icon">
        <img [src]="application.logo_url || 'assets/icons/company-placeholder.svg'" alt="Company Logo" 
             onerror="this.src='assets/icons/company-placeholder.svg'"/>
      </div>
      
      <div class="job-info">
        <div class="job-title">{{ application.title }}</div>
        <div class="job-meta">
          <span class="company-name">{{ application.company_name }}</span>
          <span class="separator">•</span>
          <span class="location">{{ application.location }}</span>
          <span class="separator">•</span>
          <span class="applied-date">Applied {{ application.applied_at | relativeTime }}</span>
        </div>
      </div>

      <div class="status-section">
        <div class="status-badge" 
             [style.background-color]="getStatusColor(application.status) + '20'" 
             [style.color]="getStatusColor(application.status)">
          {{ application.status | capitalizeFirst }}
        </div>
      </div>

      <div class="actions-section">
        <div class="dropdown">
          <button class="btn btn-link job-menu" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" (click)="viewJob(application)">
              <i class="fas fa-eye me-2"></i>View Job
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" (click)="retractApplication(application)">
              <i class="fas fa-times-circle me-2"></i>Retract Application
            </a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <button class="btn btn-outline-secondary btn-sm" 
              [disabled]="currentPage === 1"
              (click)="changePage(currentPage - 1)">
        <i class="fas fa-chevron-left"></i>
      </button>
      <span class="page-info">Page {{currentPage}} of {{totalPages}}</span>
      <button class="btn btn-outline-secondary btn-sm" 
              [disabled]="currentPage === totalPages"
              (click)="changePage(currentPage + 1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div class="no-data" *ngIf="!isLoading && applications.length === 0">
    <div class="empty-state-content">
      <img src="assets/EmptyImg.svg" alt="No applications" class="empty-state-image mb-3" />
      <h5 class="empty-state-title">No Applications Yet</h5>
      <p class="empty-state-subtitle">You haven't applied to any jobs yet. Start your search today!</p>
      <a routerLink="/jobs" class="btn btn-primary mt-3">Browse Jobs</a>
    </div>
  </div>

  <!-- Retract Modal -->
  <div class="modal fade show" *ngIf="showRetractModal" style="display: block; background: rgba(0,0,0,0.5);" (click)="closeRetractModal()">
    <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Retract Application</h5>
          <button type="button" class="btn-close" (click)="closeRetractModal()"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to retract this application? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeRetractModal()">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="confirmRetract()" [disabled]="isRetracting">
            <span *ngIf="isRetracting"><i class="fas fa-spinner fa-spin me-2"></i>Retracting...</span>
            <span *ngIf="!isRetracting">Retract Application</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
